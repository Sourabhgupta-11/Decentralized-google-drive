{
  "_format": "hh3-sol-build-info-1",
  "id": "solc-0_8_28-4f286b0ced6e7e8adc8c2f3d226b319efcee9075",
  "solcVersion": "0.8.28",
  "solcLongVersion": "0.8.28+commit.7893614a",
  "userSourceNameMap": {
    "contracts/fileShare.sol": "project/contracts/fileShare.sol"
  },
  "input": {
    "language": "Solidity",
    "settings": {
      "evmVersion": "cancun",
      "optimizer": {
        "enabled": true,
        "runs": 200
      },
      "outputSelection": {
        "*": {
          "": [
            "ast"
          ],
          "*": [
            "abi",
            "evm.bytecode",
            "evm.deployedBytecode",
            "evm.methodIdentifiers",
            "metadata"
          ]
        }
      },
      "remappings": []
    },
    "sources": {
      "project/contracts/fileShare.sol": {
        "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.19;\r\n\r\ncontract DecentralizedDrive {\r\n    // ---------------- STRUCT ----------------\r\n    struct File {\r\n        uint256 id;\r\n        string name;\r\n        string ipfsHash;\r\n        address owner;\r\n        uint256 uploadedAt;\r\n        bool allowReshare;\r\n    }\r\n\r\n    // ---------------- STATE VARIABLES ----------------\r\n    uint256 private fileCounter;  //total files in that contract\r\n\r\n    mapping(uint256 => File) private files;  //eg: file[1]={1,name,ipfs,..} means in id 1 this file is there\r\n    mapping(address => uint256[]) private userFiles; //eg: userFiles[0xabc...]=[1,3,6] this address has access to file id - 1,3,6\r\n    mapping(address => uint256[]) private sharedFiles;  //eg: sharedFiles[0xabc..]=[2,4] this address has been shared with file id 2,4 and now access to it\r\n    mapping(uint256 => mapping(address => bool)) private fileAccess;   //eg: fileAccess[1][0xabc..]=true means fileid 1 can be accessed by address 0xabc..\r\n    mapping(uint256 => mapping(address => address)) private sharedBy;\r\n    mapping(uint256 => address[]) private fileSharedWith;\r\n\r\n\r\n    // ---------------- EVENTS ----------------(events are like notification)\r\n    event FileUploaded(\r\n        uint256 indexed fileId,\r\n        address indexed owner,\r\n        string ipfsHash\r\n    );\r\n\r\n    event FileShared(\r\n        uint256 indexed fileId,\r\n        address indexed from,\r\n        address indexed to\r\n    );\r\n\r\n    event FileDeleted(\r\n        uint256 indexed fileId,\r\n        address indexed owner\r\n    );\r\n\r\n\r\n    // ---------------- UPLOAD FILE ----------------\r\n    function uploadFile(\r\n        string calldata _name,\r\n        string calldata _ipfsHash,\r\n        bool _allowReshare\r\n    ) external {\r\n        require(bytes(_ipfsHash).length > 0, \"Invalid IPFS hash\");\r\n\r\n        fileCounter++;\r\n\r\n        files[fileCounter] = File({\r\n            id: fileCounter,\r\n            name: _name,\r\n            ipfsHash: _ipfsHash,\r\n            owner: msg.sender,\r\n            uploadedAt: block.timestamp,\r\n            allowReshare: _allowReshare\r\n        });\r\n\r\n        userFiles[msg.sender].push(fileCounter);\r\n        fileAccess[fileCounter][msg.sender] = true;\r\n\r\n        emit FileUploaded(fileCounter, msg.sender, _ipfsHash);  //emit that event FileUploaded\r\n    }\r\n\r\n    // ---------------- VIEW MY FILES ----------------\r\n    function getMyFiles() external view returns (File[] memory) {\r\n        uint256[] memory ids = userFiles[msg.sender];\r\n        File[] memory result = new File[](ids.length);\r\n\r\n        for (uint256 i = 0; i < ids.length; i++) {\r\n            result[i] = files[ids[i]];\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    // ---------------- VIEW SHARED FILES ----------------\r\n    function getSharedFiles() external view returns (File[] memory) {\r\n        uint256[] memory ids = sharedFiles[msg.sender];\r\n        File[] memory result = new File[](ids.length);\r\n\r\n        for (uint256 i = 0; i < ids.length; i++) {\r\n            result[i] = files[ids[i]];\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    // ---------------- SHARE FILE ----------------\r\n    function shareFile(uint256 _fileId, address _to) external {\r\n        require(fileAccess[_fileId][msg.sender], \"No access\");\r\n        require(_to != address(0), \"Invalid address\");\r\n\r\n        if (msg.sender != files[_fileId].owner) {\r\n            require(files[_fileId].allowReshare, \"Resharing not allowed\");\r\n        }\r\n\r\n        require(!fileAccess[_fileId][_to], \"Already has access\");\r\n\r\n        fileAccess[_fileId][_to] = true;\r\n        sharedFiles[_to].push(_fileId);\r\n        fileSharedWith[_fileId].push(_to);\r\n        sharedBy[_fileId][_to] = msg.sender;   //\"to\" address ko file kisne share ki thi (jisne ye function call kiya tha)\r\n    }\r\n\r\n    //--------------------REMOVE SHARE ACCESS---------------------------\r\n    function removeShareAccess(uint256 _fileId, address _user) external {\r\n        require(fileAccess[_fileId][_user], \"User has no access\");\r\n\r\n        address owner = files[_fileId].owner;\r\n        address sharer = sharedBy[_fileId][_user];\r\n\r\n        require(\r\n            msg.sender == owner || msg.sender == sharer,\r\n            \"Not authorized to remove access\"\r\n        );\r\n\r\n        fileAccess[_fileId][_user] = false;\r\n\r\n        uint256[] storage ids = sharedFiles[_user];\r\n        for (uint256 i = 0; i < ids.length; i++) {\r\n            if (ids[i] == _fileId) {\r\n                ids[i] = ids[ids.length - 1];\r\n                ids.pop();\r\n                break;\r\n            }\r\n        }\r\n\r\n        address[] storage sharedList = fileSharedWith[_fileId];\r\n        for (uint256 i = 0; i < sharedList.length; i++) {\r\n            if (sharedList[i] == _user) {\r\n                sharedList[i] = sharedList[sharedList.length - 1];\r\n                sharedList.pop();\r\n                break;\r\n            }\r\n        }\r\n\r\n        delete sharedBy[_fileId][_user];\r\n    }\r\n\r\n\r\n\r\n\r\n    // ---------------- DELETE FILE ----------------\r\n    function deleteFile(uint256 _fileId) external {\r\n        require(files[_fileId].owner == msg.sender, \"Not file owner\");\r\n\r\n        fileAccess[_fileId][msg.sender] = false;\r\n\r\n        uint256[] storage ownerFiles = userFiles[msg.sender];\r\n        for (uint256 i = 0; i < ownerFiles.length; i++) {\r\n            if (ownerFiles[i] == _fileId) {\r\n                ownerFiles[i] = ownerFiles[ownerFiles.length - 1];\r\n                ownerFiles.pop();\r\n                break;\r\n            }\r\n        }\r\n\r\n        address[] storage sharedUsers = fileSharedWith[_fileId];\r\n        for (uint256 i = 0; i < sharedUsers.length; i++) {\r\n            address user = sharedUsers[i];\r\n\r\n            fileAccess[_fileId][user] = false;\r\n            uint256[] storage userShared = sharedFiles[user];\r\n            for (uint256 j = 0; j < userShared.length; j++) {\r\n                if (userShared[j] == _fileId) {\r\n                    userShared[j] = userShared[userShared.length - 1];\r\n                    userShared.pop();\r\n                    break;\r\n                }\r\n            }\r\n            delete sharedBy[_fileId][user];\r\n        }\r\n        delete fileSharedWith[_fileId];\r\n        delete files[_fileId];\r\n        emit FileDeleted(_fileId, msg.sender);\r\n    }\r\n\r\n    //---------------------Additional Function----------------------\r\n    function getFile(uint256 _fileId) external view returns (File memory) {\r\n        require(fileAccess[_fileId][msg.sender], \"Access denied\");\r\n        return files[_fileId];\r\n    }\r\n\r\n    function hasAccess(uint256 _fileId, address _user)external view returns (bool){\r\n        return fileAccess[_fileId][_user];\r\n    }\r\n\r\n    function getFileSharedWith(uint256 _fileId) external view returns (address[] memory){\r\n        require(_fileId > 0 && _fileId <= fileCounter, \"Invalid file\");\r\n        return fileSharedWith[_fileId];\r\n    }\r\n\r\n    function getSharedBy(uint256 _fileId, address _user)external view returns (address){\r\n        return sharedBy[_fileId][_user];\r\n    }\r\n\r\n    function getFileId() external view returns(uint256){\r\n        return fileCounter;\r\n    }\r\n}\r\n"
      }
    }
  }
}